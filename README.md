<div align="center">

# <img src="docs/static/logo.png" width="45" align="center"> Save Any Bot

**ç®€ä½“ä¸­æ–‡** | [English](./README_en.md)

> **æŠŠ Telegram ä¸Šçš„æ–‡ä»¶è½¬å­˜åˆ°å¤šç§å­˜å‚¨ç«¯ã€‚æœ¬ç‰ˆæœ¬æ–°å¢åˆ†ç‰‡ä¸Šä¼ æ¥æ”¶ç«¯ï¼Œç”¨äºç»•è¿‡ Cloudflare 100MB é™åˆ¶å¹¶é€‚é… OpenList æœ¬åœ°å­˜å‚¨ã€‚**

[![Release Date](https://img.shields.io/github/release-date/Haruka041/SaveAny-Bot?label=release)](https://github.com/Haruka041/SaveAny-Bot/releases)
[![tag](https://img.shields.io/github/v/tag/Haruka041/SaveAny-Bot.svg)](https://github.com/Haruka041/SaveAny-Bot/releases)
[![Build Status](https://img.shields.io/github/actions/workflow/status/Haruka041/SaveAny-Bot/build-release.yml)](https://github.com/Haruka041/SaveAny-Bot/actions/workflows/build-release.yml)
[![Stars](https://img.shields.io/github/stars/Haruka041/SaveAny-Bot?style=flat)](https://github.com/Haruka041/SaveAny-Bot/stargazers)
[![Downloads](https://img.shields.io/github/downloads/Haruka041/SaveAny-Bot/total)](https://github.com/Haruka041/SaveAny-Bot/releases)
[![Issues](https://img.shields.io/github/issues/Haruka041/SaveAny-Bot)](https://github.com/Haruka041/SaveAny-Bot/issues)
[![Pull Requests](https://img.shields.io/github/issues-pr/Haruka041/SaveAny-Bot?label=pr)](https://github.com/Haruka041/SaveAny-Bot/pulls)
[![License](https://img.shields.io/github/license/Haruka041/SaveAny-Bot)](./LICENSE)

</div>

## æ¦‚è¿°

SaveAny-Bot æ˜¯ä¸€ä¸ª Telegram æœºå™¨äººï¼Œå¯å°† Telegram ä¸ç½‘ç«™çš„åª’ä½“å†…å®¹è½¬å­˜åˆ°å¤šç§å­˜å‚¨ç«¯ã€‚æœ¬ç‰ˆæœ¬åŠ å…¥äº†åˆ†ç‰‡æ¥æ”¶æœåŠ¡ï¼Œä¸“é—¨ç”¨äº OpenList æœ¬åœ°å­˜å‚¨çš„ç¨³å®šå¤§æ–‡ä»¶ä¸Šä¼ ï¼Œé¿å… Cloudflare çš„ 100MB è¯·æ±‚ä½“é™åˆ¶ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- æ”¯æŒæ–‡æ¡£/è§†é¢‘/å›¾ç‰‡/è´´çº¸â€¦ç”šè‡³è¿˜æœ‰ [Telegraph](https://telegra.ph/)
- ç ´è§£ç¦æ­¢ä¿å­˜çš„æ–‡ä»¶
- æ‰¹é‡ä¸‹è½½ä¸æµå¼ä¼ è¾“
- å¤šç”¨æˆ·ä¸å­˜å‚¨è§„åˆ™è‡ªåŠ¨æ•´ç†
- ç›‘å¬å¹¶è‡ªåŠ¨è½¬å­˜æŒ‡å®šèŠå¤©çš„æ¶ˆæ¯, æ”¯æŒè¿‡æ»¤
- åœ¨ä¸åŒå­˜å‚¨ç«¯ä¹‹é—´è½¬å­˜æ–‡ä»¶
- é›†æˆ yt-dlp, ä»æ‰€æ”¯æŒçš„ç½‘ç«™ä¸‹è½½å¹¶è½¬å­˜åª’ä½“æ–‡ä»¶
- é›†æˆ Aria2, æ”¯æŒç›´é“¾/ç£åŠ›ä¸‹è½½å’Œè½¬å­˜
- ä½¿ç”¨ JS ç¼–å†™è§£æå™¨æ’ä»¶ä»¥è½¬å­˜ä»»æ„ç½‘ç«™çš„æ–‡ä»¶
- å­˜å‚¨ç«¯æ”¯æŒ:
  - Alist
  - S3
  - WebDAV
  - æœ¬åœ°ç£ç›˜
  - Telegram (é‡ä¼ å›æŒ‡å®šèŠå¤©)

## æœ¬ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ï¼ˆåˆ†ç‰‡ä¸Šä¼ ï¼‰

- WebDAV å­˜å‚¨æ–°å¢ `receiver_url`ï¼Œå°†ä¸Šä¼ è½¬å‘åˆ°åˆ†ç‰‡æ¥æ”¶ç«¯ã€‚
- æ–­ç‚¹ç»­ä¼ ï¼ˆæœåŠ¡ç«¯æ ¡éªŒ offsetï¼‰ã€‚
- staging â†’ final åŸå­ç§»åŠ¨ï¼Œå®Œæˆåæ‰å¯¹å¤–å¯è§ã€‚
- ä¸Šä¼ æ¸…å•ä¸æ—¥å¿—è®°å½•ï¼ˆä¾¿äºå®¡è®¡/æ’æŸ¥ï¼‰ã€‚
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„ staging æ–‡ä»¶ã€‚

## æ¶æ„ä¸æµç¨‹

1. Bot ç«¯æŠŠæ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ åˆ°æ¥æ”¶ç«¯ï¼ˆ`/upload_chunk`ï¼‰ã€‚
2. æ¥æ”¶ç«¯å†™å…¥ staging å¹¶è®°å½•è¿›åº¦ã€‚
3. Bot ç«¯è°ƒç”¨ `/complete`ï¼Œæ¥æ”¶ç«¯å°†æ–‡ä»¶ç§»åŠ¨åˆ° OpenList æœ¬åœ°ç›®å½•ã€‚
4. OpenList è¯»å–æœ¬åœ°å­˜å‚¨ç›®å½•ï¼Œæ–‡ä»¶å¯è§ã€‚

## éƒ¨ç½²

### 1) æ¥æ”¶ç«¯ï¼ˆDockerï¼‰

```bash
cd file-receiver
docker compose up -d --build
```

### 2) æ¥æ”¶ç«¯ï¼ˆsystemdï¼‰

```bash
sudo cp file-receiver.service /etc/systemd/system/file-receiver.service
sudo systemctl daemon-reload
sudo systemctl enable --now file-receiver
```

### 3) Bot ç«¯ï¼ˆç¤ºä¾‹ï¼‰

```bash
go run ./cmd
```

## é…ç½®è¯´æ˜

### å…¨å±€é…ç½®ï¼ˆèŠ‚é€‰ï¼‰

- `stream`: true ä¸ºæµå¼ä¸‹è½½ï¼›false ä¼šç¼“å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼ˆæ›´åˆ©äºæ–­ç‚¹ç»­ä¼ ï¼‰ã€‚
- `workers`: å¹¶å‘ä¸‹è½½ä»»åŠ¡æ•°ã€‚
- `threads`: å•ä»»åŠ¡æœ€å¤§çº¿ç¨‹æ•°ã€‚

### WebDAV / OpenList å­˜å‚¨ï¼ˆå…³é”®ï¼‰

```toml
[[storages]]
name = "OpenList"
type = "webdav"
enable = true
base_path = "/"
receiver_url = "http://<receiver-host>:8080"
chunk_size_mb = 10
chunk_retries = 3

# å¦‚æœä»éœ€ WebDAV çš„åˆ—ç›®å½•/è¯»å–åŠŸèƒ½å¯ä¿ç•™:
# url = "https://example.com/dav"
# username = "username"
# password = "password"
```

æ³¨æ„ï¼š
- `base_path` å»ºè®®è®¾ä¸º `/`ï¼Œé¿å…æœ€ç»ˆç›®å½•é‡å¤ï¼ˆä¾‹å¦‚ `/Tele/Tele`ï¼‰ã€‚
- `receiver_url` å¯ç”¨åï¼Œä¸Šä¼ ä¼šèµ°æ¥æ”¶ç«¯ï¼›ä¸å¡«åˆ™å›é€€ä¸º WebDAV ç›´ä¼ ã€‚

### æ–­ç‚¹ç»­ä¼ è¡Œä¸º

- **å¯ seek çš„è¯»æºï¼ˆstream=falseï¼‰**ï¼šå¯ä»å·²ä¸Šä¼  offset ç»§ç»­ã€‚
- **ä¸å¯ seekï¼ˆstream=trueï¼‰**ï¼šä¸­æ–­åä¼šé‡ç½® staging å¹¶é‡æ–°ä¸Šä¼ ã€‚

## å®Œæ•´ config.toml ç¤ºä¾‹ï¼ˆå·²è„±æ•ï¼‰

```toml
# å…¨å±€é…ç½®
stream = true
workers = 3
threads = 4

[telegram]
token = "YOUR_BOT_TOKEN"
app_id = 123456
app_hash = "YOUR_APP_HASH"

[telegram.userbot]
enable = true
session = "data/usersession.db"

[[storages]]
name = "OpenList"
type = "webdav"
enable = true
base_path = "/"
receiver_url = "http://<receiver-host>:8080"
chunk_size_mb = 10
chunk_retries = 3

# å¦‚æœä»éœ€ WebDAV çš„åˆ—ç›®å½•/è¯»å–åŠŸèƒ½å¯ä¿ç•™:
# url = "https://example.com/dav"
# username = "username"
# password = "password"

[[users]]
id = 1234567890
storages = ["OpenList"]
blacklist = false
```

## æ¥æ”¶ç«¯ç¯å¢ƒå˜é‡

- `FINAL_DIR`: æœ€ç»ˆç›®å½•ï¼ˆOpenList æœ¬åœ°å­˜å‚¨è·¯å¾„ï¼‰
- `STAGING_DIR`: åˆ†ç‰‡ä¸´æ—¶ç›®å½•
- `MANIFEST_DIR`: ä¸Šä¼ æ¸…å•ç›®å½•
- `LOG_PATH`: ä¸Šä¼ æ—¥å¿—
- `STAGING_TTL_HOURS`: è¿‡æœŸæ¸…ç†æ—¶é—´ï¼ˆå°æ—¶ï¼‰

## æ¥æ”¶ç«¯æ¥å£

- `POST /upload_chunk`: ä¸Šä¼ åˆ†ç‰‡ï¼ˆå‚æ•°ï¼š`file`, `filename`, `upload_id`, `offset`ï¼‰
- `POST /complete`: åˆå¹¶å®Œæˆï¼ˆå‚æ•°ï¼š`filename`, `upload_id`ï¼‰
- `GET /status`: æŸ¥è¯¢ä¸Šä¼ è¿›åº¦ï¼ˆå‚æ•°ï¼š`upload_id`ï¼‰
- `POST /reset`: æ¸…ç†æŸä¸ª upload_id çš„ staging
- `GET /healthz`: å¥åº·æ£€æŸ¥

## å¸¸è§é—®é¢˜

- **æ–‡ä»¶è·¯å¾„é‡å¤ï¼ˆå¦‚ Tele/Teleï¼‰**ï¼šæ£€æŸ¥ `base_path` æ˜¯å¦ä¸º `/`ã€‚
- **ä¸Šä¼ å¡ä½/å¤±è´¥**ï¼šç¡®è®¤æ¥æ”¶ç«¯å¯è®¿é—®ï¼Œé¿å…ç» Cloudflare ä»£ç†ä¸Šä¼ å¤§æ–‡ä»¶ã€‚
- **OpenList æœªæ˜¾ç¤º**ï¼šåˆ·æ–°ç›®å½•æˆ–æ£€æŸ¥ `FINAL_DIR` æ˜¯å¦æŒ‡å‘æ­£ç¡®è·¯å¾„ã€‚

## å®‰å…¨å»ºè®®

- æ¥æ”¶ç«¯é»˜è®¤ä¸åšé‰´æƒï¼Œå»ºè®®åªåœ¨å†…ç½‘ä½¿ç”¨ã€‚
- è‹¥éœ€è¦å…¬ç½‘è®¿é—®ï¼Œè¯·åœ¨åä»£å±‚åŠ é‰´æƒ/é™é€Ÿ/ç™½åå•ã€‚

## é¸£è°¢

- [gotd](https://github.com/gotd/td)
- [TG-FileStreamBot](https://github.com/EverythingSuckz/TG-FileStreamBot)
- [gotgproto](https://github.com/celestix/gotgproto)
- [tdl](https://github.com/iyear/tdl)
- All the dependencies, contributors and users.
